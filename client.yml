---
 - hosts: clients
   become: true
   vars: 
     firefox_version         : 
                                 - "40.0"
                                 - "37.0"
# default version of firefox
     firefox_default         : "{{ firefox_version[0] }}"
     firefox_link_dir        : "/usr/local/bin"
     firefox_instalL_dir     : "/opt/firefox/"
     firefox_tmp_dir         : "/tmp/firefox"

# URL Construction
     firefox_lang            : "en-US"
     firefox_arch            : "linux-x86_64"
     firefox_archive         : "firefox-{{ item }}.tar.bz2"
     firefox_url             : "https://ftp.mozilla.org/pub/firefox/releases/{{ item }}/{{ firefox_arch }}/{{ firefox_lang }}/{{ firefox_archive }}"
   tasks:
           - name: Install required tools
             apt: name={{item}} state=installed
             with_items:
                     - unzip

           - name: Get firefox dependencies from apt
             shell: 'apt install -s firefox | grep Inst | grep -v firefox | cut -d" " -f 2'
             register: firefox_apt_deps
             changed_when: False

           - name: Install firefox dependencies
             apt: name={{ item }} state=latest
             with_items:
                     - "{{ firefox_apt_deps.stdout_lines }}"
             when: firefox_apt_deps.stdout_lines is defined

           - name: Create temp directory
             file:  path={{ item }} state=directory  mode=0755
             with_items:
                     - "{{ firefox_tmp_dir }}"

           - name: Create firefox install directory
             file:  path={{ firefox_instalL_dir }}/{{ item }} state=directory  mode=0755
             with_items:
                     - "{{ firefox_version }}"
           
           - name: Get firefox package
             get_url:   url={{ firefox_url }} dest={{ firefox_tmp_dir }}/{{ firefox_archive }}
             with_items:
                     - "{{ firefox_version }}"

           - name: Extract firefox archive 
             command: tar -xvjf {{ firefox_tmp_dir }}/{{ firefox_archive }} {{ firefox_instalL_dir }}/{{ item }}
             with_items:
                     - "{{ firefox_version }}"
           
           - name: Link to default version
             file: src={{ firefox_instalL_dir }}/{{ firefox_default }}/firefox/firefox dest={{ firefox_link_dir }}/firefox force=yes state='link'---

