
var map_div, details, win_w, win_h, win, header, bubble, header_position, slides_inner, slides_animation_timeout,
    groups_container, sectors_container, overlay, popup, need_toggle, cover, need_sector, need_obj, page_up, 
    menu, body, service_guide, sticker, slides, logos, menu_icon, logo_sizer, logo_width, msnry,
    templet         = '',
    service_tabs_width = 0,
    page_up_visible = false,
    is_mobile       = false,
    is_masonry      = false,
    page_url        = '',
    current_groups  = 1,
    total_groups    = 1,
    current_slide   = 1,
    current_sectors = 1,
    total_sectors   = 1,
    total_slides    = 1,
    logos_margin    = 79,
    header_height   = 79,
    is_touch        = true;
    is_masonry_27	= false;
    //latitude        = 54.687143,
    //longitude       = 25.279656;
$(document).ready(function(){
    page_up             = $('#page_up');
    cover               = $('#cover');
    overlay             = $('#total_popup_overlay');
    popup               = $('#total_popup');
    popup_content       = $('#total_popup_content');
    map_div             = $('#map');
    details             = $('#details');
    header              = $('#header');
    slides_inner        = $('#slides_inner');
    groups_container    = $('#groups_container');
    sectors_container   = $('#sectors_container');
    win                 = $(window);
    win_w               = $(window).width();
    win_h               = $(window).height();
    bubble              = $('.logo_bubble');
    menu                = $('#menu');
    body                = $('html,body');
    service_guide       = $('#service_guide_item');
    sticker             = $('#sticker');
    slides              = $('#slides');
    logos               = $('#logos');
    menu_icon           = $('#menu_icon');
    logo_sizer          = $('#logo_sizer');
    //citation    = $('.logo_citation');
    //if (typeof logo_citations != 'undefined' && typeof logo_citations[0] != 'undefined')
    //    citation.text
    //console.log('.'+need_obj+' .sector_long');
    setLayouts();
    $(window).bind("scroll", function(){
        onScroll();
    }); 
    if (Modernizr.touch) {
        touchFunction();
        is_touch = true;
        $('body').addClass('is-touch');
    } else {
        is_touch = false;
    }
    if ($('.content_block_5').length)
        addVideos();
    $('video').each(function(){this.muted=true});
    if (!("ontouchstart" in document.documentElement)) {
        //document.documentElement.className += " no-touch";
    }
    FastClick.attach(document.body);
    countBlockItems();
    onScroll();
    if($('.content_block_27_list').length){
    	enable27Masonry();
    }
    if (typeof loadScriptDo != undefined) {
	    loadScript();
    }
     if (typeof checkInputsDo != undefined) {
    	checkInputs
    }
    resetIns();
    resetGroups();
});

function addVideos() {
    $('.content_block_5_video').each(function(){
        var video = $(this).data('video');
        var id = $(this).attr('id');
        if (video && id) {
            $('#'+id).videoBG({
                mp4:page_url+'/video/'+video+'.mp4',
                ogv:page_url+'/video/'+video+'.ogv',
                webm:page_url+'/video/'+video+'.webm',
                poster:page_url+'/'+video+'.jpg',
                scale:true,
                zIndex:0
            });
            
        }
    });
}

$(window).load(function(){
    win_w   = $(window).width();
    win_h   = $(window).height();
    setLayouts();
    if (slides_inner.length > 0)
        startAnimatingSlides();
    //if (need_obj){
        //goToObj($('.'+need_obj+' .sector_long'));
        //$('.'+need_obj).find('.sector_more').click();
    //}
    var hash = window.location.hash;
    if (hash){
        hash = hash.replace('#','');
        if ($('div[data-alias="'+hash+'"]').length>0)
            $('div[data-alias="'+hash+'"]').click();
    }
//    $("#menu_outer").mCustomScrollbar({advanced:{updateOnContentResize: true}});
    $(".bullet_items").mCustomScrollbar({advanced:{updateOnContentResize: true}});
    enableMasonry();
});

$(window).resize(function(){
    win_w   = $(window).width();
    win_h   = $(window).height();
    setLayouts();
    enableMasonry();
    resetGroups();
    resetSectors();
    resetIns();
});

$(document).on('click','#total_popup_overlay',function(){
    closePopup();
});

$(document).on('click','a',function(e) {
	var href = $(this).attr("href");
	var pos = href.indexOf('#');
	if (pos) {
		page = href.substring(0, pos);
		hash = href.replace(page+'#','');
		if ($('[data-alias="'+hash+'"]').length) {
			$('[data-alias="'+hash+'"]').click();
		}
	}
});

$(document).on('mousemove','#logos',function(e){
    var offset = $(this).offset();
    var offset_position = 0;
    var x = Math.round(e.pageX - offset.left);
    var tabs_container_width = $(this).parent().width();
    if (x > offset_position)
        var margin = Math.round((logo_width - tabs_container_width + 20) / ((tabs_container_width - offset_position) / x));
    else 
        var margin = 0;
    if (margin >= 0)
        logo_sizer.css({marginLeft:-margin+'px'});
});

$(document).on('mousemove','.service_guide_menu',function(e){
    var offset = $(this).offset();
    var offset_position = 0;
    var x = Math.round(e.pageX - offset.left);
    var tabs_container_width = $(this).parent().width();
    if (x > offset_position)
        var margin = Math.round((service_tabs_width - tabs_container_width + 20) / ((tabs_container_width - offset_position) / x));
    else 
        var margin = 0;
    if (margin >= 0)
        $('.service_guide_inner').css({marginLeft:-margin+'px'});
});

$(document).on('mouseleave','.service_guide_menu',function(){
    $('.service_guide_inner').stop().animate({marginLeft:0},{duration:200});
});

$(document).on('mouseenter','.logo_block',function(){
    $(this).find('.logo_bubble').stop().fadeIn(200);
});

$(document).on('mouseleave','.logo_block',function(){
    $(this).find('.logo_bubble').stop().fadeOut(200);
});

$(document).on('keyup','#recaptcha_response_field',function(){
    $('#ContactReChallengeField').val($('#recaptcha_challenge_field').val());
    $('#ContactReResponseField').val($(this).val());
});

$(document).on('change','#ContactAttachment',function(){
    var name = $(this).val().split("\\");
    $(this).parent().find('label').text(name[name.length - 1]);
});

$(document).on('click','.service_tab',function(e){
    var nr = $(this).attr('data-nr');
    var position = 0;
    if (nr) {
        var el = $('.content_block_item[data-in-line="'+nr+'"]');
        if (el)
            var position = el.offset().top-header.height()-service_guide.height()+5;
    }
    body.animate({scrollTop:position},600);
});

$(document).on('click','.more_block_27',function(e){
	var el = $(this).parent().parent().parent();
	$(this).addClass('hidden');
	el.css({width:el.parent().width()-20+'px'});
	el.find('.less_block_27').removeClass('hidden');
	el.find('.visible_right').stop().animate({width:'940px'},{duration:250});
	if(el.hasClass('item_in_2')){
		el.insertBefore(el.prev());
	}else if(el.hasClass('item_in_3')){
		el.insertBefore(el.prev().prev());
	}
	reset27masonry();
    var po = el.offset().top;//+need_sector.height()-header.height();
    body.stop().animate({scrollTop:po-140},150);
    
});

$(document).on('click','.less_block_27',function(e){
	var el = $(this).parent().parent();
	$(this).addClass('hidden');
	el.find('.more_block_27').removeClass('hidden');
	el.css({width:300+'px'});
	if(el.hasClass('item_in_2')){
		el.insertAfter(el.next());
	}else if(el.hasClass('item_in_3')){
		el.insertAfter(el.next().next());
	}
	reset27masonry();
});

//$(document).on('click','.templet-homepage #AjaxChatForm input[type="submit"]',function(e){
//	alert('a');
//});
function makeCall(el){
	if(el=='#AjaxChatForm' && $('body').hasClass('templet-homepage')){
		_gaq.push(['_trackEvent', 'Kontaktai', 'Išsiųstas pranešimas', 'titulinio išsiskleidžianti forma']);
	}
	if(el=='#ExpandedContact' && $('body').hasClass('templet-contacts')){
		_gaq.push(['_trackEvent', 'Kontaktai', 'Išsiųstas pranešimas', 'Kontaktų puslapyje']);
	}
	if(el=='#ExpandedContact' && $('body').hasClass('templet-career')){
		_gaq.push(['_trackEvent', 'Kontaktai', 'Išsiųstas pranešimas', 'Karjeros puslapyje']);
	}	
}


$(document).on('click','#menu_icon',function(){
    if (menu.hasClass('mobile_hidden')) {
        menu.removeClass('mobile_hidden');
        menu.addClass('mobile_visible');
    } else {
        menu.addClass('mobile_hidden');
        menu.removeClass('mobile_visible');
    }
});

$(document).on('click','.tab_link',function(){
    if (!$(this).hasClass('active')) {
        $('.tab_link', '#contact_block_tabs').removeClass('active');
        $(this).addClass('active');
        if ($(this).hasClass('map')) {
            details.hide();
            map_div.show();          
        } else {
            map_div.hide();
            details.show();
        }
    }
});

$(document).on('click','.sector_less',function(){
    $(this).parent().parent().parent().removeClass('active');
    $(this).parent().parent().stop().slideUp(300);
});

$(document).on('click','#page_up',function(){
    goToObj($('body'));
});

$(document).on('click','.sector_more',function(){
    if (!$(this).parent().parent().parent().hasClass('active')) {
        $('.sector_outer').removeClass('active');
        $('.sector_long').stop().slideUp(300);
        need_sector = $(this).parent().parent().parent();
        var this_hash = $(this).attr('data-alias');
        setTimeout(function(){
            //var distance = (win_h+header.height()-392)/2;
            //if (distance > 110)
            //    var need_pos = need_sector.find('.sector_long').offset().top - distance;
            //else
            //    var need_pos = need_sector.find('.sector_long').offset().top;
            need_pos = need_sector.offset().top+need_sector.height()-header.height();
            body.animate({scrollTop:need_pos},300);
            need_sector.addClass('active');
            need_sector.find('.sector_long').stop().slideDown(300);
            window.location.hash = this_hash;
        },400);
    }
});

$(document).on('click','.btn_bullets',function(){
    var el = $(this).parent().find('.bullet_items');
    el.toggleClass('active');
    $(this).toggleClass('active');
    if ($(this).hasClass('active'))
        body.animate({scrollTop:$(this).offset().top-el.height()-20-79});
});

$(document).on('click','.data_more',function(){
    if ($(this).parent().parent().parent().hasClass('active')) {
    } else {
        $(this).parent().parent().parent().parent().find('.item_outer').removeClass('active');
        need_toggle = $(this).parent().parent().parent();
        setTimeout(function(){
            need_toggle.addClass('active');
            goToObj(need_toggle.find('.long_data'));
        },300);
    }
});

$(document).on('click','.data_less',function(){
    $(this).parent().parent().removeClass('active');
    goToObj($(this).parent().parent());
});

$(document).on('click','.facilities_link',function(){
    var nr = $(this).attr('data-nr');
    var prev = $(this).parent().parent().attr('data-nr');
    if(!prev)
    	prev=1;
    	console.log(nr,prev);
    if(nr && prev && !$(this).parent().hasClass('active')) {
        $(this).parent().parent().attr('data-nr',nr);
        $(this).parent().parent().find('.active').removeClass('active');
        $(this).parent().addClass('active');
        var items = $(this).parent().parent().parent().parent().parent();
        items.find('.item[data-nr="'+prev+'"]').each(function(){
            $(this).stop().fadeOut(400,function(){
                items.find('.item[data-nr="'+nr+'"]').each(function(){
                    $(this).stop().fadeIn(400);
                });
            });
        });
    }    
});

$(document).on('click','.sticker_link',function(){
    $('.sticker_link').removeClass('no_border');
    if (!$(this).hasClass('active')) {
        $('.sticker_link').removeClass('active');
        $('.sticker_block').addClass('inactive');
        $(this).addClass('active');
        var target = $(this).data('target');
        var nr = $(this).data('nr');
        if (target)
            $(target).delay(2000).removeClass('inactive');
        if (nr == 1)
            $('.sticker_link').addClass('no_border');
        else if (nr == 2)
            $('.sticker_link.chat').addClass('no_border');
    } else {
        $(this).removeClass('active')
        var target = $(this).data('target');
        if (target)
            $(target).addClass('inactive');
    }
});

$(document).on('click','.more_pvz',function(){
    if ($(this).parent().parent().hasClass('active')) {
        $(this).parent().parent().removeClass('active');
    } else {
        $(this).parent().parent().parent().find('.item').each(function(){
            $(this).removeClass('active');
        });
        $(this).parent().parent().addClass('active');
    }
});

$(document).on('click','.close_long',function(){
    $(this).parent().parent().removeClass('active');
});

$(document).on('click','.btn_two_blocks',function(){
    if ($(this).parent().parent().hasClass('active')) {
        $(this).parent().parent().removeClass('active');
    } else {
        $(this).parent().parent().parent().find('.item').removeClass('active');
        $(this).parent().parent().addClass('active');
    }
});

$(document).on('click','.slide_arrow_right',function(){
    animateSlide(current_slide + 1);
});

$(document).on('click','.slide_arrow_left',function(){
    animateSlide(current_slide - 1);
});

$(document).on('click','.slide_bullet',function(){
    var nr = $(this).attr('data-nr');
    if (!$(this).hasClass('active') && nr)
        animateSlide(nr);
});

$(document).on('click','.arrow_group_right:not(.inactive)',function(){
    animateGroups(current_groups + 1);
});

$(document).on('click','.arrow_group_left:not(.inactive)',function(){
    animateGroups(current_groups - 1);
});

$(document).on('click','.arrow_sectors_right',function(){
    animateSectors(current_sectors + 1);
});

$(document).on('click','.arrow_sectors_left',function(){
    animateSectors(current_sectors - 1);
});

$(document).on('click','.know_more_link',function(){
    goTo(win_h);
});

$(document).on('click','#cover_contact_button',function(){
    $(this).parent().addClass('opened');
});

$(document).on('click','.cover_btn',function(){
    $(this).hide();
    $('#cover_contact').show();
});

$(document).on('change','input, textarea, select',function(){
    checkThis(this);
});

$(document).on('focus','input, textarea, select',function(){
    $(this).removeClass('error');
});

$(document).on('click','.a1',function(){
    $('.l1').hide();
    $('.a1').hide();
    $(this).parent().parent().find('li.li1').hide();
    $(this).parent().show();
    $('.u2').show();
});

$(document).on('click','.back2',function(){
    $('.l1').show();
    $('.a1').show();
    $('.li1').show();
    $('.u2').hide();
});


$(document).on('mousemove','#cover, #slides',function(event){
    if (event.pageX > win_w / 2) {
        $(this).find('.slide_arrow_right').addClass('side');
        $(this).find('.slide_arrow_left').removeClass('side');
    } else {
        $(this).find('.slide_arrow_left').addClass('side');
        $(this).find('.slide_arrow_right').removeClass('side');        
    }
});

function countBlockItems() {
    if ($('.content_block_item').length) {
        var nr = 0;
        $('.content_block_item').each(function(){
            nr++;
            $(this).attr('data-in-line',nr);
        });
    }
}

function touchFunction(){
    $('.l1').bind('click',function(){
        if (!menu_icon.is(':visible')){
            event.preventDefault();
            $('.li1').removeClass('hover');
            $(this).parent().toggleClass('hover');
        }
    });
    var pageLinks = document.getElementsByClassName('l1');
    for(var i = 0; i < pageLinks.length; i++){
        Hammer(pageLinks[i]).on("doubletap", function(event) {
            var url = $(this).attr('href');
            if (url)
                window.location.href = url;
        });
    }
    var pageBody = document.getElementsByTagName('body');
    for(var i = 0; i < pageBody.length; i++){
        Hammer(pageBody[i]).on("drag", function(event) {
            $('.li1').removeClass('hover');
        });    
    }
    //$('.slide_arrow').addClass('touch');
}

function closePopup() {
    overlay.fadeOut(150);
    popup.fadeOut(150,function(){
        popup_content.html('');
    });
}

function resetGroups(){
    if (groups_container.length) {
        var this_total = $('.service_animation').length;
	    $('.arrow_group_right, arrow_group_left').hide();
	    if (win_w < 640) {
	    	if (this_total > 1)
		    	$('.arrow_group_right, arrow_group_left').show();
		    else
		    	$('.arrow_group_right, arrow_group_left').hide();
	    } else if (win_w < 768) {
	    	if (this_total > 2)
		    	$('.arrow_group_right, arrow_group_left').show();
		    else
		    	$('.arrow_group_right, arrow_group_left').hide();
	    } else if (win_w < 980) {
	    	if (this_total > 3)
		    	$('.arrow_group_right, arrow_group_left').show();
		    else
		    	$('.arrow_group_right, arrow_group_left').hide();
       	} else {
	    	if (this_total > 4)
		    	$('.arrow_group_right, arrow_group_left').show();
		    else
		    	$('.arrow_group_right, arrow_group_left').hide();
       	}
        current_groups = 1;
        groups_container.css({marginLeft:0});
        $('.arrow_group_left').addClass('inactive');
        $('.arrow_group_right').removeClass('inactive');
    }
}

function animateGroups(nr) {
    if (nr) {
        var total_groups = $('.service_animation').length;
        var this_total = total_groups;
        var distance = 260;
        if (win_w < 570) {
            this_total = this_total+3;
            distance = 300;
        } else if (win_w < 768) {
            this_total = this_total+2;
            distance = 300;
        } else if (win_w < 980) {
            distance = 187;
        }
//        console.log(this_total);
        current_groups = nr;
        groups_container.stop().animate(
            {marginLeft:-(distance * (current_groups - 1)) +'px'},
            {duration:300}
        );
        if (current_groups > 1)
            $('.arrow_group_left').removeClass('inactive');
        else 
            $('.arrow_group_left').addClass('inactive');
        if (current_groups < this_total - 3)
            $('.arrow_group_right').removeClass('inactive');
        else 
            $('.arrow_group_right').addClass('inactive');
    }    
}

function resetSectors(){
    if (sectors_container.length) {
        current_sectors = 1;
        sectors_container.css({marginLeft:0});
        $('.arrow_sectors_left').addClass('inactive');
        $('.arrow_sectors_right').removeClass('inactive');
    }
}

function animateSectors(nr) {
    if (nr) {
    	var total_sectors = $('#sectors #sectors_area #sectors_container #sector_table .sector_animation').length;
        var this_total = total_sectors;
        if (win_w < 570) {
            this_total = this_total+3;
        } else if (win_w < 768) {
            this_total = this_total+2;
        } else if (win_w < 980) {
            this_total = this_total+1;
        }
        current_sectors = nr;
        sectors_container.stop().animate(
            {marginLeft:-(240 * (current_sectors - 1)) +'px'},
            {duration:300}
        );
        if (current_sectors > 1)
            $('.arrow_sectors_left').removeClass('inactive');
        else 
            $('.arrow_sectors_left').addClass('inactive');
        if (current_sectors < this_total - 3)
            $('.arrow_sectors_right').removeClass('inactive');
        else 
            $('.arrow_sectors_right').addClass('inactive');
    }    
}

function animateSlide(nr) {
    if (nr) {
        /*
        nr = parseInt(nr);
        $('.slide_bullet').removeClass('active');
        $('.slide_bullet[data-nr="'+nr+'"]').addClass('active');
        $('.cover_btn').show();
        $('#cover_contact').hide();
        current_slide = nr;
        clearTimeout(slides_animation_timeout);
        slides_inner.stop().animate(
            {marginLeft:-(win_w * (current_slide - 1)) +'px'},
            {duration:500,complete:function(){startAnimatingSlides();}}
        );
        if (current_slide > 1)
            $('.slide_arrow_left').show();
        else 
            $('.slide_arrow_left').hide();
        if (current_slide < total_slides)
            $('.slide_arrow_right').show();
        else 
            $('.slide_arrow_right').hide();
        */
       var total_slides = $('.slide').length;
        nr = parseInt(nr);
        var prev = current_slide;
        $('.slide_bullet').removeClass('active');
        $('.slide_bullet[data-nr="'+nr+'"]').addClass('active');
        $('.cover_btn').show();
        //$('#cover_contact').hide();
        current_slide = nr;
        clearTimeout(slides_animation_timeout);
        
        $('.slide_'+prev).stop().fadeOut(500);
        $('.slide_'+current_slide).stop().fadeIn(500,function(){
            startAnimatingSlides();
        });
        
        if (current_slide > 1)
            $('.slide_arrow_left').show();
        else 
            $('.slide_arrow_left').hide();
        if (current_slide < total_slides)
            $('.slide_arrow_right').show();
        else 
            $('.slide_arrow_right').hide();
    }
}

function startAnimatingSlides() {
    slides_animation_timeout = setTimeout(function(){
        if (current_slide < total_slides)
            animateSlide(current_slide + 1);
    },6000);
}

function checkInputs() {
    $('input').each(function(){
        checkThis(this);
    });
    $('textarea').each(function(){
        checkThis(this);
    });
    $('select').each(function(){
        checkThis(this);
    });
}

function checkThis(el) {
    if ($(el).val() != ''){
        $(el).parent().find('label').addClass('fill');
        $(el).parent().find('select').addClass('fill');
    }
    else {
        $(el).parent().find('label').removeClass('fill');
        $(el).parent().find('select').removeClass('fill');
    }
}

function initializeMap() {
    var latlng = new google.maps.LatLng(latitude,longitude);
    var zoomed = 14;
    var myOptions = {
        zoom:zoomed,
        minZoom:10,
        maxZoom:18,
        center:latlng,
        scrollwheel:false,
        streetViewControl:false,
        panControl:false,
        mapTypeControl:true,
        mapTypeId:google.maps.MapTypeId.ROADMAP
    };
    map = new google.maps.Map(document.getElementById("map"),myOptions);
    addMarker();
    return true;
}

function addMarker() {
    var location = new google.maps.LatLng(latitude,longitude);
    marker = new google.maps.Marker({
        position:location,
        map:map
    });
    var infoWindow = new google.maps.InfoWindow;
    new google.maps.event.addListener(marker,'click',function(){
        map.setCenter(location);
        infoWindow.open(map, marker);
        map.setZoom(15);
    });
    map.setZoom(15);
}

function expandedSubmit(el) {
    if (el) {
        var url = $(el).attr('action');
        var obj = {};
        var postData_1 = $(el).serializeArray();
        var postData_2 = $('#RecaptchaForm').serializeArray();
        $.extend(postData_1, postData_2);
        $.ajax({
            url: url,
            dataType: 'html',
            type: 'GET',
            data: postData_1,
            success: function(data) {
                $('#contact_expanded').html(data);
            }
        });
    }
}

function loginAction() {
    window.location.reload();
}

function hideTimeout(el) {
   setTimeout(function(){
       $(el).fadeOut(400,function(){
           $(this).parent().parent().removeClass('opened');
       });
   },2000);
}

function setLayouts() {
    win_w               = $(window).width();
    win_h               = $(window).height();
    body.removeClass('desktop').removeClass('tablet').removeClass('mobile').removeClass('window_480');
    if (win_w > 980) {
        body.addClass('desktop');
    //} else if (win_w > 768) {
    } else if (!menu_icon.is(':visible')) {
        body.addClass('tablet');
    } else {
        body.addClass('mobile');
    }
    if (win_w < 481) {
        body.addClass('window_480');
    }
    if (!body.hasClass('mobile')) {
        $('.u1').show();
        $('.l1').show();
        $('.a1').hide();
        $('.li1').show();
        $('.u2').show();
    } else {
        $('.a1').show();
    }
    if (!body.hasClass('window_480')) {
        if (body.hasClass('tablet')) {
            header_height = 60;
            logos_margin = 60;
        } else {
            header_height = 79;
            logos_margin = 79;
        }
    } else {
        logos_margin = 67;
        header_height = 47;
    }
    $('.with_cover').css({paddingTop:win_h+header_height+'px'});
    $('.header_with_cover').css({top:win_h+'px'});
    $('.logos_with_cover').css({marginTop:win_h-logos_margin+'px'});
    header.data('position',header.position());
    if ($('.slide').length > 0) {
        //$('.slide').css({'width':win_w + 'px'});
        //$('#slides_inner').css({'width': (win_w * $('.slide').length) + 'px'});
    }
    if ($('.cover').length > 0) {
        $('.cover').css({'width':win_w + 'px',height:win_h + 'px'});
        $('#slides_inner').css({'width': (win_w * $('.cover').length) + 'px'});
    }
    if ($(".bullet_items").length) {
        var max_height = win_h-79-53-40;
        $(".bullet_items").css({maxHeight:max_height+'px'});
        //if ($(".bullet_items").height > max_height)
        //else 
        //    $(".bullet_items").css({height:'auto'});
    }
    if ($('.service_tab').length) {
        service_tabs_width = 0;
        $('.service_tab').each(function(){
            service_tabs_width += $(this).width() + 36;
        });
    }
    $('.logo_bubble').hide();
    if (templet == 'homepage' && slides_inner.length) {
        $('#slides').css({height:win_h-header.height()-$('#logos').height()+'px'});
    }
    logo_width = 0;
    $('.logo_block').each(function(){
        logo_width+=$(this).width()+60;
    });
    logo_width+=160;
    logo_sizer.css({width:logo_width+'px'});
}

function enableMasonry() {
    setTimeout(function(){
        var $container = $('#masonry_item_container');
        var w = $('.masonry_item').width()+20;
        if (is_masonry)
            $container.masonry('destroy');
        $.when(
            $container.masonry({
                columnWidth: w,//function( containerWidth ) { return containerWidth / 2; },
                itemSelector: '.masonry_item'
            })
        ).then(function(){
            is_masonry = true;
        });
    },0);
}

function enable27Masonry() {
    var $container = $('.content_block_27_list');
    //var container = document.querySelector('.content_block_27_list');
    var w = 320;//$('.item_27').width()+20;
    //if(is_masonry_27)
    //    $container.masonry('destroy');
    $.when(
    	/*
		msnry = new Masonry(container, {
            columnWidth: w,
            itemSelector: '.item_27'
		})
		*/
        $container.masonry({
            columnWidth: w,
            itemSelector: '.item_27'
        })
    ).then(function(){
        is_masonry_27=true;
    });
}

function reset27masonry(){
	/*
	var container = $('.content_block_27_list');//.masonry({});
var msnry = new Masonry( container, {
  columnWidth: 320
});
*/
	//msnry.layout();
	//$('.content_block_27_list').masonry('destroy');
	//enable27Masonry();
	//$('.content_block_27_list').masonry('reloadItems')
	//msnry.destroy();
	//enable27Masonry();
	$('.content_block_27_list').masonry('destroy');
	enable27Masonry();
}


function onScroll() {
    // header position
    var h_pos   = header.data('position'),
        scroll  = getScroll();
    if (h_pos.top < scroll.top)
        header.addClass('fixed');
    else
        header.removeClass('fixed');
    var from_top = $(window).scrollTop();
    if (!is_mobile) {
        if (($('#slides').length) && from_top < win_h) {
            $('.slide').css({
               backgroundPosition:'center ' + (300 / win_h * from_top) + 'px' 
            });
        }
        if ((cover.length) && from_top < win_h) {
            $('.cover').css({
               backgroundPosition:'center ' + (300 / win_h * from_top) + 'px' 
            });
        }
    }
    if (!page_up_visible && from_top > win_h * 2) {
        page_up_visible = true;
        page_up.addClass('visible');
    } else if (page_up_visible && from_top < win_h * 2) {
        page_up_visible = false;
        page_up.stop().removeClass('visible');
    }
    if (service_guide.length) {
        body_class = body.hasClass('desktop') ? 'desktop' : body.hasClass('tablet') ? 'tablet' : 'mobile' ;
        if (body_class == 'desktop') {
            if (from_top >= 410)
                service_guide.addClass('fixed');
            else 
                service_guide.removeClass('fixed');
        }
        var current_layer = 0;
        var top_elements_height = header.height()+service_guide.height()+5;
        $('.content_block_item').each(function(){
            if (from_top + top_elements_height > $(this).offset().top)
            current_layer++;
        });
        $('.service_tab').removeClass('active');
        if (current_layer)
            $('.service_tab[data-nr="'+current_layer+'"]').addClass('active');
        else 
            $('.service_tab.home').addClass('active');
    }
    if (cover.length)
        var arrow_position = cover.height()/2+$('.slide_arrow_right').height()/2;
    else 
        var arrow_position = header.height()+slides.height()/2+$('.slide_arrow_right').height()/2;
    if (from_top <= (arrow_position - 300)) {
        sticker.addClass('top_position');
        sticker.css({top:(arrow_position+1)+'px'});
    } else {
        sticker.removeClass('top_position');
        sticker.removeAttr('style');
    }
}

function getScroll(){
    var b = document.body;
    var e = document.documentElement;
    return {
        left: parseFloat( window.pageXOffset || b.scrollLeft || e.scrollLeft ),
        top: parseFloat( window.pageYOffset || b.scrollTop || e.scrollTop )
    };
}

function goTo(position) {
    if (position)
        $('html,body').stop().animate({
            scrollTop: position
        }, 2000);
}

function goToEl(el) {
    if (el)
        $('html,body').stop().animate({
            scrollTop: $(el).offset().top - 90
        }, 1000);
}

function goToObj(obj) {
    if (obj)
        $('html,body').stop().animate({
            scrollTop: obj.offset().top - 90
        }, 1000);
}

function addLang() {
	if (document.location.href == page_location && !user_mobile) {
		history.replaceState('data', '', page_location+lng+'/');
	}
	page_location = page_location+lng+'/';
}

function makeAjax(element) {
    if (element) {
        var url = $(element).attr('data-url');
        var target = $(element).attr('data-target');
        if (url) {
            $.ajax({
                url: url,
                dataType: 'html',
                type: 'GET',
                beforeSend: function() {
                    if (!target)
                       overlay.fadeIn(150);
                },
                success: function(data) {
                    if (target) {
                        $(target).html(data);
                    } else {
                        popup_content.html(data);
                        centerPopup();
                        popup.show();
                    }
                }
            });
        }
    }
}

function centerPopup(){
    popup.css({
        top:'60px',
        left:'80px',
        height:win_h-120+'px',
        width:win_w-160+'px',
        margin:0
    });
}

$(function(){
    var $window = $(window);        //Window object
    var scrollTime = .3;           //Scroll time
    var scrollDistance = 100;       //Distance. Use smaller value for shorter scroll and greater value for longer scroll
    $window.on("mousewheel DOMMouseScroll", function(event){
        event.preventDefault(); 
        var delta = event.originalEvent.wheelDelta/120 || -event.originalEvent.detail/3;
        var scrollTop = $window.scrollTop();
        var finalScroll = scrollTop - parseInt(delta*scrollDistance);
        TweenMax.to($window, scrollTime, {
                scrollTo:{y:finalScroll, autoKill:true},
                ease:Power1.easeOut,   //For more easing functions see http://api.greensock.com/js/com/greensock/easing/package-detail.html
                autoKill:true,
                overwrite:5,
                onUpdate:onScroll
            }
        );
    });
});

// blocks

$(document).on('click','.block_9_tabs',function(){
    if ($(this).hasClass('active')) {
        $(this).removeClass('active');
    } else {
        $('.block_9_tabs').removeClass('active');
        $(this).addClass('active');
    }
});


$(document).on('click', '.big', function(){
    $(this).parent().find('.small').slideToggle(150);
    if ($(this).parent().hasClass('active'))
        $(this).parent().removeClass('active')
    else
        $(this).parent().addClass('active');
});

// SCROLL
var keys=[37,38,39,40];function preventDefault(a){a=a||window.event;if(a.preventDefault){a.preventDefault()}a.returnValue=false}function keydown(b){for(var a=keys.length;a--;){if(b.keyCode===keys[a]){preventDefault(b);return}}}function wheel(a){preventDefault(a)}function disable_scroll(){if(window.addEventListener){window.addEventListener("DOMMouseScroll",wheel,false)}window.onmousewheel=document.onmousewheel=wheel;document.onkeydown=keydown}function enable_scroll(){if(window.removeEventListener){window.removeEventListener("DOMMouseScroll",wheel,false)}window.onmousewheel=document.onmousewheel=document.onkeydown=null};

var an_1, an_2, an_3, an_4, an_5, an_6, an_7, an_8;
var at = 'Power1.easeInOut';
var lin = 'Linear.easeNone';
window.onload = function (){
    setAnimations();
}

function setAnimations() {
    $('.animation').each(function(){
        var animation = $(this).data('animation');
        var id = $(this).attr('id');
        if (typeof id != 'undefined' && animation && typeof window['setAnimation'+animation] == 'function' && typeof 'an_'+id != 'undefined') {
            eval('setAnimation'+animation+'("'+id+'")');
        }
    });
}

function setAnimation3(id) {
    var el = $('#'+id);
    var obj = $('.el_1', el);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.to(obj,0.4,{top:'36px',ease:Power1.easeInOut})
    .to(obj,0.4,{top:'56px',ease:Power1.easeInOut})
    .to(obj,0.4,{top:'36px',ease:Power1.easeInOut})
    .to(obj,0.4,{top:'56px',ease:Power1.easeInOut});
    tl.stop();
    window[id] = tl;
}

function setAnimation1(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_1 = $('.el_1', el);
    var obj_2 = $('.el_2', el);
    var obj_3 = $('.el_3', el);
    var obj_4 = $('.el_4', el);
    tl.to(obj_1,0.3,{opacity:1,marginTop:0,ease:at})
    .to(obj_2,0.3,{opacity:1,marginTop:0,ease:at})
    .to(obj_3,0.3,{opacity:1,marginTop:0,ease:at})
    .to(obj_4,0.3,{opacity:1,marginTop:0,ease:at});
    tl.stop();
    window[id] = tl;
}

function setAnimation2(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_1 = $('.el_1', el);
    var obj_2 = $('.el_2', el);
    var obj_3 = $('.el_3', el);
    tl.to(obj_1,0.3,{left:'43px',top:'107px',ease:at},'one')
    .to(obj_2,0.3,{left:'77px',top:'40px',ease:at},'one')
    .to(obj_1,0.3,{left:'111px',top:'107px',ease:at},'two')
    .to(obj_3,0.3,{left:'43px',top:'107px',ease:at},'two')
    .to(obj_1,0.3,{left:'77px',top:'40px',ease:at},'three')
    .to(obj_2,0.3,{left:'111px',top:'107px',ease:at},'three') 
    .to(obj_2,0.3,{left:'43px',top:'107px',ease:at},'four')
    .to(obj_3,0.3,{left:'111px',top:'107px',ease:at},'four');
    tl.stop();
    window[id] = tl;
}

function setAnimation4(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_1 = $('.el_1', el);
    var obj_2 = $('.el_2', el);
    var obj_3 = $('.el_3', el);
    tl.to(obj_1,0.3,{left:'43px',top:'107px',ease:at},'one')
    .to(obj_2,0.3,{left:'77px',top:'40px',ease:at},'one')
    .to(obj_1,0.3,{left:'111px',top:'107px',ease:at},'two')
    .to(obj_3,0.3,{left:'43px',top:'107px',ease:at},'two')
    .to(obj_1,0.3,{left:'77px',top:'40px',ease:at},'three')
    .to(obj_2,0.3,{left:'111px',top:'107px',ease:at},'three') 
    .to(obj_2,0.3,{left:'43px',top:'107px',ease:at},'four')
    .to(obj_3,0.3,{left:'111px',top:'107px',ease:at},'four');
    tl.stop();
    window[id] = tl;
}

function setAnimation5(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_1 = $('.el_1', el);
    tl.to(obj_1,3,{left:'-758px',ease:lin});
    tl.stop();
    window[id] = tl;
}

function setAnimation6(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_1 = $('.el_1', el);
    tl.to(obj_1,1,{height:'36px',top:'96px',ease:lin});
    tl.stop();
    window[id] = tl;
}

function setAnimation7(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_2 = $('.el_2', el);
    var obj_3 = $('.el_3', el);
    var obj_4 = $('.el_4', el);
    var obj_5 = $('.el_5', el);
    var obj_6 = $('.el_6', el);
    var obj_7 = $('.el_7', el);
    var obj_8 = $('.el_8', el);
    tl.to(obj_2,1,{top:'108px',ease:at},'one')
    .to(obj_3,1,{top:'89px',ease:at},'one')
    .to(obj_4,1,{top:'98px',ease:at},'one')
    .to(obj_5,1,{top:'76px',ease:at},'one')
    .to(obj_6,1,{rotation:'-75deg',left:'72px',ease:at},'one')
    .to(obj_7,.8,{rotation:'80deg',ease:at,delay:0.2},'one')
    .to(obj_7,.6,{height:'16px',ease:at,delay:0.1},'one')
    .to(obj_7,.4,{top:'86px',left:'91px',ease:at,delay:0.1},'one')
    .to(obj_8,1,{rotation:'-93deg',left:'116px',ease:at},'one');
    tl.stop();
    window[id] = tl;
}

function setAnimation8(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_2 = $('.el_2', el);
    var obj_3 = $('.el_3', el);
    var obj_4 = $('.el_4', el);
    tl.to(obj_2,0,{height:'7px',delay:.07})
    .to(obj_2,0,{height:'15px',delay:.07})
    .to(obj_2,0,{height:'26px',delay:.07})
    .to(obj_2,0,{height:'39px',delay:.07})
    .to(obj_2,0,{height:'55px',delay:.07})
    .to(obj_2,0,{height:'71px',delay:.07})
    .to(obj_2,0,{height:'86px',delay:.07})
    .to(obj_2,0,{height:'100px',delay:.07})
    .to(obj_2,0,{height:'112px',delay:.07})
    .to(obj_2,0,{height:'120px',delay:.07})
    .to(obj_2,0,{height:'127px',delay:.07})
    .to(obj_2,0,{height:'131px',width:'74px',delay:.07})
    .to(obj_2,0,{height:'133px',width:'86px',delay:.07})
    .to(obj_3,0,{width:'12px',delay:.07})
    .to(obj_3,0,{width:'29px',delay:.07})
    .to(obj_3,0,{width:'44px',delay:.07})
    .to(obj_3,0,{width:'59px',delay:.07})
    .to(obj_3,0,{width:'72px',delay:.07})
    .to(obj_3,0,{width:'82px',delay:.07})
    .to(obj_3,0,{width:'90px',delay:.07})
    .to(obj_3,0,{width:'94px',height:'69px',delay:.07})
    .to(obj_3,0,{height:'85px',delay:.07})
    .to(obj_3,0,{height:'100px',delay:.07})
    .to(obj_3,0,{height:'113px',delay:.07})
    .to(obj_3,0,{height:'123px',delay:.07},'last')
    .to(obj_4,.15,{opacity:'1',delay:.07},'last');
    tl.stop();
    window[id] = tl;
}

function setAnimation9(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_1 = $('.el_1', el);
    var obj_3 = $('.el_3', el);
    var obj_2 = $('.el_2', el);
    tl.to(obj_1,.7,{top:'-1px',ease:at},'one')
    .to(obj_3,.7,{top:'118px',ease:at},'one')
    .to(obj_2,.3,{top:'88px',ease:at},'-=0.3');
    tl.stop();
    window[id] = tl;
}

function setAnimation10(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_1 = $('.el_1', el);
    var obj_2 = $('.el_2', el);
    tl.to(obj_1,2.8,{rotationY:-360,ease:lin},'one')
    .to(obj_2,2.8,{rotationY:-360,ease:lin},'one')
    .to(obj_2,0,{opacity:1,ease:lin},'two-=2.1')
    .to(obj_2,0,{opacity:0,ease:lin},'two-=0.7')
    .to(obj_1,0,{opacity:0,ease:lin},'two-=2.1')
    .to(obj_1,0,{opacity:1,ease:lin},'two-=0.7');
    tl.timeScale(2);
    tl.stop();
    window[id] = tl;
}

function setAnimation11(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_1 = $('.el_1', el);
    var obj_2 = $('.el_2', el);
    tl.to(obj_1,0.6,{left:'-75px',top:'-116px',ease:lin},'one')
    .to(obj_2,0.6,{left:'203px',top:'-117px',ease:lin},'one');

    tl.stop();
    window[id] = tl;
}

function setAnimation12(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_1 = $('.el_1', el);
    var obj_3 = $('.el_3', el);
    var obj_4 = $('.el_4', el);
    tl.to(obj_1,0.6,{top:'-25px',ease:at},'one')
    .to(obj_3,0.6,{top:'23px',ease:at},'one')
    .to(obj_4,0.6,{height:'120px',ease:at},'one');
    tl.stop();
    window[id] = tl;
}

function setAnimation13(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj = $('.el_inner', el);
    tl.to(obj,0,{marginLeft:'-111px',delay:0.1})
    .to(obj,0,{marginLeft:'-222px',delay:0.1})
    .to(obj,0,{marginLeft:'-333px',delay:0.1})
    .to(obj,0,{marginLeft:'-444px',delay:0.1})
    .to(obj,0,{marginLeft:'-555px',delay:0.1})
    .to(obj,0,{marginLeft:'-666px',delay:0.1})
    .to(obj,0,{marginLeft:'-777px',delay:0.1})
    .to(obj,0,{marginLeft:'-888px',delay:0.1})
    .to(obj,0,{marginLeft:'-999px',delay:0.1})
    .to(obj,0,{marginLeft:'-1110px',delay:0.1})
    .to(obj,0,{marginLeft:'-1221px',delay:0.1})
    .to(obj,0,{marginLeft:'-1332px',delay:0.1})
    .to(obj,0,{marginLeft:'-1443px',delay:0.1})
    .to(obj,0,{marginLeft:'-1554px',delay:0.1})
    .to(obj,0,{marginLeft:'-1665px',delay:0.1})
    .to(obj,0,{marginLeft:'-1776px',delay:0.1})
    .to(obj,0,{marginLeft:'-1887px',delay:0.1})
    .to(obj,0,{marginLeft:'-1998px',delay:0.1})
    .to(obj,0,{marginLeft:'-2109px',delay:0.1})
    .to(obj,0,{marginLeft:'-2220px',delay:0.1})
    .to(obj,0,{marginLeft:'-2331px',delay:0.1})
    .to(obj,0,{marginLeft:'-2442px',delay:0.1})
    .to(obj,0,{marginLeft:'-2553px',delay:0.1})
    .to(obj,0,{marginLeft:'-2664px',delay:0.1})
    .to(obj,0,{marginLeft:'-2775px',delay:0.1})
    .to(obj,0,{marginLeft:'-2886px',delay:0.1})
    .to(obj,0,{marginLeft:'-2997px',delay:0.1})
    .to(obj,0,{marginLeft:'-3108px',delay:0.1})
    .to(obj,0,{marginLeft:'-3219px',delay:0.1});
    tl.timeScale(4);
    tl.stop();
    window[id] = tl;
}

function setAnimation14(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_1 = $('.el_1', el);
    var obj_2 = $('.el_2', el);
    var obj_3 = $('.el_3', el);
    var obj_4 = $('.el_4', el);
    var obj_5 = $('.el_5', el);
    var obj_6 = $('.el_6', el);
    var obj_7 = $('.el_7', el);
    var obj_8 = $('.el_8', el);
    tl.to(obj_2,0.2,{opacity:1,left:'61px',top:'42px',delay:0.2})
    .to(obj_3,0.2,{opacity:1,left:'71px',top:'32px',delay:0.2})
    .to(obj_4,0.2,{opacity:1,left:'81px',top:'22px',delay:0.2})
    .to(obj_5,0.2,{opacity:1,left:'91px',top:'12px',delay:0.2})
    .to(obj_6,0.2,{opacity:1,left:'101px',top:'2px',delay:0.2})
    .to(obj_7,0.2,{opacity:1,left:'111px',top:'-8px',delay:0.2})
    .to(obj_8,0.2,{opacity:1,left:'121px',top:'-18px',delay:0.2});
    tl.timeScale(2);
    tl.stop();
    window[id] = tl;
}

function setAnimation101(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_2 = $('.el_2', el);
    var obj_3 = $('.el_3', el);
    tl.to(obj_2,0.15,{opacity:1})
    .to(obj_3,0.1,{opacity:1,delay:0.1})
    .to(obj_2,0.1,{opacity:0,delay:0.1})
    .to(obj_3,0.1,{opacity:0,delay:0.1})
    .to(obj_2,0.15,{opacity:1,delay:0.1})
    .to(obj_3,0.1,{opacity:1,delay:0.1})
    .to(obj_2,0.1,{opacity:0,delay:0.1})
    .to(obj_3,0.1,{opacity:0,delay:0.1});
    tl.timeScale(0.7);
    tl.stop();
    window[id] = tl;
}

function setAnimation102(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_1 = $('.el_2_1', el);
    var obj_2 = $('.el_2_2', el);
    var obj_3 = $('.el_2_3', el);
    tl.to(obj_1,0.15,{left:'30px',bottom:'28px',width:'50px',height:'67px',opacity:1})
    .to(obj_2,0.15,{left: '65px',bottom: '48px',width: '52px',height: '38px',opacity:1})
    .to(obj_3,0.20,{left: '111px',bottom: '44px',width: '49px',height: '99px',opacity:1});
    //tl.timeScale(0.7);
    tl.stop();
    window[id] = tl;
}

function setAnimation103(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_2 = $('.el_2', el);
    var obj_3 = $('.el_3', el);
    tl.to(obj_3,0.1,{opacity:1},'zero')
    .to(obj_3,0.2,{left:'73px',bottom:'30px',delay:0.2},'one')
    .to(obj_2,0.2,{width:'16px',delay:0.2},'one')
    .to(obj_3,0.3,{left:'94px',bottom:'61px'},'two')
    .to(obj_2,0.2,{width:'37px'},'two')
    .to(obj_3,0.1,{opacity:0,delay:0.2},'last');
    tl.stop();
    window[id] = tl;
}

function setAnimation104(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_2 = $('.el_2', el);
    tl.to(obj_2,1.5,{rotationY:-360,ease:lin});
    tl.stop();
    window[id] = tl;
}

function setAnimation105(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_3 = $('.el_3', el);
    var obj_4 = $('.el_4', el);
    var obj_5 = $('.el_5', el);
    tl.to(obj_3,1,{width:'67px',ease:lin},'one')
    .to(obj_4,1,{width:'41px',ease:lin},'one')
    .to(obj_5,1,{width:'41px',ease:lin},'one');
    tl.timeScale(2);
    tl.stop();
    window[id] = tl;
}

function setAnimation106(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_2 = $('.el_2', el);
    tl.to(obj_2,0.3,{opacity:1})
    .to(obj_2,0.3,{opacity:0})
    .to(obj_2,0.3,{opacity:1,delay:0.4})
    .to(obj_2,0.3,{opacity:0})
    .to(obj_2,0.3,{opacity:1,delay:0.4});
    tl.timeScale(1.5);
    tl.stop();
    window[id] = tl;
}

function setAnimation107(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_1 = $('.el_1', el);
    var obj_2 = $('.el_2', el);
    var obj_3 = $('.el_3', el);
    var obj_4 = $('.el_4', el); 
    var obj_5 = $('.el_5', el);
    var obj_6 = $('.el_6', el);
    var obj_7 = $('.el_7', el);
    var obj_8 = $('.el_8', el);     
    var obj_9 = $('.el_9', el);
    var obj_10 = $('.el_10', el);
    var obj_11 = $('.el_11', el);
    var obj_12 = $('.el_12', el);     
    var obj_13 = $('.el_13', el);
    var obj_14 = $('.el_14', el);
    var obj_15 = $('.el_15', el);
    var obj_16 = $('.el_16', el); 
    var obj_17 = $('.el_17', el);
    var obj_18 = $('.el_18', el);
    var obj_19 = $('.el_19', el);
    var obj_20 = $('.el_20', el); 
    var obj_21 = $('.el_21', el);
    var obj_22 = $('.el_22', el);
    var obj_23 = $('.el_23', el);
    var obj_24 = $('.el_24', el); 
    tl.to(obj_4,0.1,{opacity:0},'a1')
    .to(obj_3,0.1,{opacity:1},'a2')
    .to(obj_19,0.1,{opacity:0},'a3')
    .to(obj_20,0.1,{opacity:1},'a4')
    .to(obj_6,0.1,{opacity:0},'a3')
    .to(obj_5,0.1,{opacity:1},'a4')
    .to(obj_10,0.1,{opacity:0},'a5')
    .to(obj_9,0.1,{opacity:1},'a6')
    .to(obj_7,0.1,{opacity:0},'a5')
    .to(obj_8,0.1,{opacity:1},'a6')
    .to(obj_14,0.1,{opacity:0},'a5')
    .to(obj_13,0.1,{opacity:1},'a6')
    .to(obj_1,0.1,{opacity:0},'a7')
    .to(obj_2,0.1,{opacity:1},'a8')
    .to(obj_11,0.1,{opacity:0},'a7')
    .to(obj_12,0.1,{opacity:1},'a8')
    .to(obj_21,0.1,{opacity:0},'a9')
    .to(obj_22,0.1,{opacity:1},'a10')
    .to(obj_16,0.1,{opacity:0},'a9')
    .to(obj_15,0.1,{opacity:1},'a10')
    .to(obj_17,0.1,{opacity:0},'a11')
    .to(obj_18,0.1,{opacity:1},'a12')
    .to(obj_24,0.1,{opacity:0},'a11')
    .to(obj_23,0.1,{opacity:1},'a12');
    tl.timeScale(1.5);
    tl.stop();
    window[id] = tl;
}

function setAnimation108(id) {
    var el = $('#'+id);
    var tl = new TimelineLite({onComplete:endAnimation,onCompleteParams:[el]});
    tl.eventCallback("onReverseComplete", reverseCallback);
    tl.eventCallback("onReverseCompleteParams", [el]);
    var obj_1 = $('.el_1', el);
    var obj_2 = $('.el_2', el);
    tl.to(obj_1,2,{rotation:'180deg'},'one')
    .to(obj_2,2,{rotation:'180deg'},'one');
    //tl.timeScale(2);
    tl.stop();
    window[id] = tl;
}

function reverseCallback(el) {
    $(el).removeClass('playing');
}

function endAnimation(el) {
    var id = $(el).attr('id');
    if (id && typeof window[id] != 'undefined' && !$(el).hasClass('active')) {
        eval(id).reverse();
    } 
}

$(document).on('mouseenter','.animation',function(){
    if (!is_touch) {
        var id = $(this).attr('id');
        if (id && typeof window[id] != 'undefined' && !$(this).hasClass('playing')) {
            $(this).addClass('playing').addClass('active');
            eval(id).restart();
        } else if (id && typeof window[id] != 'undefined') {
            $(this).addClass('playing').addClass('active');
            eval(id).play();
        }
    }
});

$(document).on('mouseleave','.animation',function(){
    if (!is_touch) {
        var id = $(this).attr('id');
        if (id && typeof window[id] != 'undefined' && $(this).hasClass('active')) {
            $(this).removeClass('active');
            eval(id).reverse();
        }
    }
});

// new
$(document).on('touchstart','#menu > li:last-child > a',function(){
	window.location.href = $(this).attr('href');
});


// add
var yt;
function makeAjaxN(el) {
	yt = $(el).attr('data-yt');
	if (yt && yt != 'n') {
		if (is_touch) {
			window.location.href = 'https://www.youtube.com/embed/'+yt+'?rel=0&amp;autoplay=1';
		} else {
			player.pauseVideo();
			overlay.fadeIn(150);
			$('#total_popup').fadeIn(150);
			$('#total_popup_content').html('<div class="close-youtube"></div><iframe webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="" class="youtube-iframe" src="https://www.youtube.com/embed/'+yt+'?rel=0&amp;autoplay=1"></iframe>');
		}
	}
}
$(document).on('click','.close-youtube',function(){
	overlay.fadeOut(150);
	player.playVideo();
	$('#total_popup').fadeOut(150,function(){
		$('#total_popup_content').html('');
	});
});
var player;
$(function(){
	if ($('#player').length) {
	  var tag = document.createElement('script');
	  tag.src = "http://www.youtube.com/player_api";
	  var firstScriptTag = document.getElementsByTagName('script')[0];
	  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
	}
});
  function onYouTubePlayerAPIReady() {
    player = new YT.Player('player', {
      playerVars: { 'autoplay': 1, 'controls': 0, '1&showinfo': 0, 'autohide':1,'wmode':'opaque' },
      videoId: $('[data-yt]').attr('data-yt'),
      events: {
        'onReady': onPlayerReady}
    });
  }

  function onPlayerReady(event) {
    event.target.mute();
  }
$(document).on('click','.arrow_in',function(){
	
});
$(document).on('click','.arrow_in.arrow_right:not(.inactive)',function(){
    animateIns(current_in + 1);
});

$(document).on('click','.arrow_in.arrow_left:not(.inactive)',function(){
    animateIns(current_in - 1);
});
var current_in = 1, total_ins = 1;
function animateIns(nr) {
    if (nr) {
        var this_total = $('.content_block_14_list .item').length;
        if (win_w < 640) {
            this_total = this_total+3;
        } else if (win_w < 768) {
            this_total = this_total+2;
        } else if (win_w < 980) {
            this_total = this_total+1;
        }
        current_in = nr;
        $('.content_block_14_list').stop().animate(
            {marginLeft:-(240 * (current_in - 1)) +'px'},
            {duration:300}
        );
        if (current_in > 1)
            $('.arrow_in.arrow_left').removeClass('inactive');
        else 
            $('.arrow_in.arrow_left').addClass('inactive');
        if (current_in < this_total - 3)
            $('.arrow_in.arrow_right').removeClass('inactive');
        else 
            $('.arrow_in.arrow_right').addClass('inactive');
    }    
}
function resetIns(){
    if ($('.content_block_14_list').length) {
        current_in = 1;
	    $('.arrow_in').hide();
	    var this_total = $('.content_block_14_list .item').length;
	    if (win_w < 640) {
	    	if (this_total > 1)
		    	$('.arrow_in').show();
		    else
		    	$('.arrow_in').hide();
	    } else if (win_w < 768) {
	    	if (this_total > 2)
		    	$('.arrow_in').show();
		    else
		    	$('.arrow_in').hide();
	    } else if (win_w < 980) {
	    	if (this_total > 3)
		    	$('.arrow_in').show();
		    else
		    	$('.arrow_in').hide();
       	} else {
	    	if (this_total > 4)
		    	$('.arrow_in').show();
		    else
		    	$('.arrow_in').hide();
       	}
        $('.content_block_14_list').css({marginLeft:0});
        $('.arrow_in.arrow_left').addClass('inactive');
        $('.arrow_in.arrow_right').removeClass('inactive');
    }
}
/////////////////////////////////////////////////////////////////////////  NEW
$(document).on('click','.point_block a',function(){
	$(this).attr('target','_blank');
	return true;
});
// tip: from top
function loadScript() {
	if (typeof latitude != 'undefined') {
	    var script = document.createElement('script');
	    script.type = 'text/javascript';
	    script.src = 'https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&callback=initializeMap';
	    document.body.appendChild(script);
	}
}
// tip: from top
$(document).on('click','.bullet_link',function(){
    var nr = $(this).attr('data-nr');
    var parent_el = $(this).parent().parent().parent().parent().parent();
    var father_el = parent_el.parent();
    var prev = parent_el.attr('data-nr');
    $(this).closest('.bullet_items').find('.bullet_item').removeClass('active');
    $(this).closest('.bullet_item').addClass('active');
    if (nr && prev) {
        parent_el.attr('data-nr',nr);
        parent_el.toggleClass('active');
        father_el.find('.btn_bullets').toggleClass('active');
        goToObj(father_el);
        father_el.find('.item[data-nr="'+prev+'"]').each(function(){
            var item = $(this);
            $(this).find('.image').animate(
                {marginTop:'-768px'},
                {duration:400,complete:function(){
                    father_el.find('.item[data-nr="'+prev+'"]').removeClass('active')
                }}
            );
            $(this).find('.left_part').fadeOut(400);
        });
        father_el.find('.item[data-nr="'+nr+'"]').each(function(){
            var text = $(this).find('.left_part');
            $(this).addClass('active');
            text.hide();
            $(this).find('.image').css({marginTop:'768px'}).animate(
                {marginTop:'0'},
                {duration:400,complete:function(){
                    text.fadeIn(400);
                }}
            );
        });
    }
});

$(document).on('touchstart', 'html', function(event){
	if (!$(event.target).parents().andSelf().is('.point')){
		$('.point').removeClass('touch');
	}
});
$(document).on('touchstart mouseenter','.point',function(e) {
	$('.point').removeClass('touch');
	$(this).addClass('touch');
	prefixInContainer($(this));
	if ($(window).width() < 768) {
		fixInContainer($(this));
	}
});
$(document).on('mouseleave','.point',function(e) {
	$(this).removeClass('touch');
});
$(document).on('touchstart', 'html', function(event){
	if (!$(event.target).parents().andSelf().is('.point')){
		$('.point').removeClass('touch');
	}
});
function prefixInContainer(el) {
	el.find('.point_block').removeAttr('style');
}
function fixInContainer(el) {
	var left = el.position().left;
	var width = el.closest('.image').width();
	el.find('.point_block').css({left:-left+78,width:width-40});
}